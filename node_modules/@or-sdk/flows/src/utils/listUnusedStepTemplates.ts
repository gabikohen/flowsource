import { Flow, StepTemplateRaw } from '@or-sdk/deployer';

function listUnusedStepTemplates(source: Flow): StepTemplateRaw[] {
  const treesObj = source?.data?.trees || {};
  const trees = Object.keys(treesObj).map(key => treesObj[key].steps);
  const stepTemplates = source?.data?.stepTemplates || [];

  const usedTemplateIds = trees.reduce((acc: string[], tree) => {
    tree.forEach(step => {
      if (acc.indexOf(step.type!) === -1) {
        acc.push(step.type!);
      }
    });

    return acc;
  }, []);

  return stepTemplates.filter(template => usedTemplateIds.indexOf(template.id) === -1);
}

export default listUnusedStepTemplates;
